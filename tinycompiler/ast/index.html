
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ssloy.github.io/tinycompiler/ast/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../sly/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Abstract syntax trees - Playing with code</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-7F81P6F3D0"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-7F81P6F3D0",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-7F81P6F3D0",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#abstract-syntax-trees" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Playing with code" class="md-header__button md-logo" aria-label="Playing with code" data-md-component="logo">
      
  <img src="../../haqreu-plate.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Playing with code
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Abstract syntax trees
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Playing with code" class="md-nav__button md-logo" aria-label="Playing with code" data-md-component="logo">
      
  <img src="../../haqreu-plate.png" alt="logo">

    </a>
    Playing with code
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinyrenderer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            tinyrenderer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/bresenham/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bresenham’s line drawing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/rasterization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triangle rasterization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/barycentric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Barycentric coordinates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/z-buffer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hidden faces removal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/camera-naive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Naive camera handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/camera/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Better camera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/shading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/textures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    More data!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/tangent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tangent space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/shadow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/ssao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ambient occlusion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/toon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bonus: toon shading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyrenderer/afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinycompiler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            tinycompiler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Abstract syntax trees
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Abstract syntax trees
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-subject" class="md-nav__link">
    <span class="md-ellipsis">
      Test Subject
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Subject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representing-real-numbers-with-integer-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Representing real numbers with integer variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-the-square-root-using-newtons-method" class="md-nav__link">
    <span class="md-ellipsis">
      Computing the square root using Newton's method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ast-for-the-sqrt" class="md-nav__link">
    <span class="md-ellipsis">
      AST for the sqrt()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-syntax-tree-to-python-code" class="md-nav__link">
    <span class="md-ellipsis">
      From syntax tree to python code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SLY: lexer and parser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../symtable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Symbol tables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Displays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assembly generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lexer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DIY lexer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DIY parser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinyoptimizer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            tinyoptimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyoptimizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyoptimizer/mem2reg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mem2reg
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinyfloat
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            tinyfloat
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/computers-and-numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computers and Numbers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/print/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Printing floats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/add/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Addition
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    strange things
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            strange things
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strange/cursed-fire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cursed fire or #define black magic
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-subject" class="md-nav__link">
    <span class="md-ellipsis">
      Test Subject
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Subject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representing-real-numbers-with-integer-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Representing real numbers with integer variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-the-square-root-using-newtons-method" class="md-nav__link">
    <span class="md-ellipsis">
      Computing the square root using Newton's method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ast-for-the-sqrt" class="md-nav__link">
    <span class="md-ellipsis">
      AST for the sqrt()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-syntax-tree-to-python-code" class="md-nav__link">
    <span class="md-ellipsis">
      From syntax tree to python code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="abstract-syntax-trees">Abstract syntax trees</h1>
<h2 id="introduction">Introduction</h2>
<p>I've checked several lectures on compilers, and nearly all of them start with lexers and parsers.
However, I suggest postponing that for now and first asking ourselves: <strong>what kind of object do we actually want to work with?</strong></p>
<p>Our input is a piece of text (just a long string), and our output should also be a piece of text.
But between these two, we need to preserve some kind of entity — <strong>a meaning</strong>.
We need a way to express this meaning, moving away from raw text, which is highly inconvenient to work with.</p>
<p>An essential part of any (imperative? Purists, feel free to correct me) programming language are <strong>expressions</strong>, both arithmetic and logical.
One of the pioneers in formalizing expressions was <a href="https://en.wikipedia.org/wiki/Jan_%C5%81ukasiewicz">Jan Łukasiewicz</a>,
who is best known for his work on <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">Reverse Polish Notation</a>.</p>
<p>For example, consider the following Boolean expression in <a href="https://en.wikipedia.org/wiki/Infix_notation">infix notation</a>:</p>
<div class="arithmatex">\[
((B\wedge A)\wedge(\neg(B\wedge A))) \wedge ((\neg C) \rightarrow A)
\]</div>
<p>To evaluate this expression, we must follow a specific order of operations, which can be represented as the following tree:</p>
<p><img alt="" src="tree.png" /></p>
<p>To compute the value of any node in the tree, we first need to evaluate its children.
This means we require memory to store intermediate results.
In standard calculators, this is often done using the <code>=</code> button (for intermediate results) and the <code>m+</code> button (for storing values).
Jan Łukasiewicz proposed using a <strong>stack</strong> instead: whenever we compute the value of a node,
we simply take the operands from the top of the stack, corresponding to a <strong>depth-first traversal</strong> of our tree.</p>
<p>In our example, we first push <span class="arithmatex">\(A\)</span> onto the stack, then <span class="arithmatex">\(C\)</span>.
Since <span class="arithmatex">\(\neg\)</span> is a <strong>unary</strong> operation, we pop a single element, evaluate it, and push the result back onto the stack.
At this point, our stack contains two elements: <span class="arithmatex">\(A\)</span> and <span class="arithmatex">\(\neg C\)</span>.
The <strong>binary</strong> operation <span class="arithmatex">\(\rightarrow\)</span> then takes both values, computes the result, and pushes it back onto the stack: <span class="arithmatex">\(((\neg C) \rightarrow A)\)</span>.</p>
<p>If we continue traversing the tree in depth-first order, all nodes will be visited in the following sequence:</p>
<div class="arithmatex">\[
A C \neg \rightarrow A B \wedge \neg A B \wedge \wedge \wedge
\]</div>
<p>This string is our original expression, rewritten from infix notation into reverse Polish notation.
Essentially, we have two representations of the same algorithm in two different languages,
while the tree helps us focus on the meaning rather than the linguistic differences.</p>
<p>Let me digress for a moment: Polish (postfix) notation eliminates the need for parentheses and the <code>=</code> button on calculators,
which significantly simplified programs for such devices.</p>
<p>In the USSR, programmable calculators like <a href="https://en.wikipedia.org/wiki/Elektronika_MK-61">Elektronika MK-61</a>
and <a href="https://en.wikipedia.org/wiki/Elektronika_MK-52">MK-52</a> were widely used — without an <code>=</code> button.
Oh, how I smirked in elementary school, bringing in a calculator that no one but me could figure out! :)</p>
<p>In the early '80s, Hewlett-Packard advertised its legendary <a href="https://en.wikipedia.org/wiki/HP-12C">HP-12C</a> with this poster:</p>
<p><img alt="" src="no-equals-780x440.png" /></p>
<p>Let me play Captain Obvious for a second: the crossed-out <code>≠</code> sign simultaneously represents the absence of that button on the calculator
and the idea that HP is unrivaled. It was a deliberate pun. And an inspired one.</p>
<!--
Personally, I get a twisted pleasure wearing a T-shirt with this print in the 2020s, even though I hate being a walking billboard.
But the number of angry comments from confused people makes up for any moral discomfort of advertising on my belly!
-->
<p>Jokes aside, reverse Polish notation is simply a linear representation of an expression’s syntax tree — the core idea, the meaning.</p>
<h2 id="test-subject">Test Subject</h2>
<p>Today, we'll work with a piece of code that computes <span class="arithmatex">\(\sqrt\pi\)</span>, storing it as a fixed-point number.</p>
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="c1">// square root of a fixed-point number</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="c1">// stored in a 32 bit integer variable, shift is the precision</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="o">:</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">shift</span><span class="o">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">        </span><span class="n">var</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="kt">int</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">        </span><span class="n">var</span><span class="w"> </span><span class="n">x_old</span><span class="o">:</span><span class="kt">int</span><span class="p">;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="n">var</span><span class="w"> </span><span class="n">n_one</span><span class="o">:</span><span class="kt">int</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2147483647</span><span class="o">/</span><span class="n">shift</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// pay attention to potential overflows</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">shift</span><span class="p">);</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift</span><span class="p">;</span><span class="w"> </span><span class="c1">// initial guess 1.0, can do better, but oh well</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">        </span><span class="n">n_one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">shift</span><span class="p">;</span><span class="w"> </span><span class="c1">// need to compensate for fixp division</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">            </span><span class="n">x_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n_one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_old</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="c1">// 25735 is approximately equal to pi * 8192;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="c1">// expected value of the output is sqrt(pi) * 8192 approx 14519</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mi">25735</span><span class="p">,</span><span class="w"> </span><span class="mi">8192</span><span class="p">);</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="representing-real-numbers-with-integer-variables">Representing real numbers with integer variables</h3>
<p>As a brief digression, let's analyze what our example program does.
I have not included IEEE 754 floating-point numbers or posits in <em>wend</em>.
It's not difficult to do, but it would bloat the compiler, and I want to keep it as compact as possible.
Having just two different types (<code>bool</code> and <code>int</code>) is sufficient to demonstrate how type checking works.</p>
<p>So what should I do if I want to work with real numbers?
My 32-bit variables may be labeled as integers, but I can interpret them however I like.
Let's say I want to store the number <span class="arithmatex">\(\pi\)</span> with an accuracy up to the fourth decimal place.
Multiplying <span class="arithmatex">\(\pi\)</span> by <span class="arithmatex">\(10^4\)</span> results in 31415.9265(...).
Thus, I can write the following code:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>p = 31415;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>print p/10000;
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>print &quot;.&quot;;
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>print p%10000;
</span></code></pre></div>
<p>This will print <code>3.1415</code> on the screen.</p>
<p>The idea is simple: we choose a multiplier <span class="arithmatex">\(m\)</span>, and to represent a desired number (in this case, <span class="arithmatex">\(\pi\)</span>), we store the integer part of the fraction <span class="arithmatex">\((\pi*m)/m\)</span>.
The value of <span class="arithmatex">\(m\)</span> determines the fixed precision of our real number representation.
Historically, powers of two have been the preferred choice for <span class="arithmatex">\(m\)</span>, as division and modulo operations can be replaced with cheaper bit shifts and bitwise AND operations.
For example, if <span class="arithmatex">\(m\)</span> is <span class="arithmatex">\(2^{31}\)</span>, we can represent numbers from -1 to 1 with a step size of approximately <span class="arithmatex">\(4.7 \times 10^{-10}\)</span>.
If <span class="arithmatex">\(m\)</span> is <span class="arithmatex">\(2^{10}\)</span>, we can represent numbers from -2,097,152 to 2,097,151 with a step size of 0.0009765625.</p>
<p>Now, let's assume we have a variable <code>p</code> containing the following 32-bit value:
<code>00000000000000000110010010000111</code>
If we execute <code>print p;</code>, the output will be <code>25735</code>.
However, I want to interpret only the upper 19 bits as the integer part, while the lower 13 bits represent the fractional part.
Using the following code:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>print p/8192;
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>print &quot;.&quot;;
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>print ((p%8192)*10000)/8192;
</span></code></pre></div>
<p>The output will be <code>3.1414</code>, which represents <span class="arithmatex">\(\pi\)</span> with a precision of 13 bits after the decimal point, slightly coarser than one ten-thousandth.</p>
<p>Addition and subtraction of fixed-point numbers are performed using integer arithmetic, provided that the exponents of both operands are the same.
If we have two fixed-point numbers <span class="arithmatex">\(p\)</span> and <span class="arithmatex">\(q\)</span> of the same precision, represented as <span class="arithmatex">\(p*m\)</span> and <span class="arithmatex">\(q*m\)</span>, then their sum:</p>
<div class="arithmatex">\[ p*m + q*m \]</div>
<p>is the representation of the sum <span class="arithmatex">\(p + q\)</span>, since:</p>
<div class="arithmatex">\[ \frac{p*m}{m} + \frac{q*m}{m} = \frac{(p+q)*m}{m} \]</div>
<p>The same logic applies to subtraction.
Multiplication, however, requires an adjustment:</p>
<div class="arithmatex">\[ (p*m) * (q*m) = p*q*m^2 \]</div>
<p>To correctly represent the product <span class="arithmatex">\(p*q\)</span> with precision <span class="arithmatex">\(m\)</span>, we must divide the product <span class="arithmatex">\(p*m * q*m\)</span> by <span class="arithmatex">\(m\)</span>.</p>
<h3 id="computing-the-square-root-using-newtons-method">Computing the square root using Newton's method</h3>
<p>My example program computes the square root of <span class="arithmatex">\(\pi\)</span> with 13-bit precision.
The algorithm itself is quite simple: if we want to compute <span class="arithmatex">\(x = \sqrt{a}\)</span> for some positive number <span class="arithmatex">\(a\)</span>,
we can use an iterative method. We start with an arbitrary value <span class="arithmatex">\(x_1\)</span> (e.g., 1) and define the sequence:</p>
<div class="arithmatex">\[
x_{n+1} = \frac{1}{2}\left(x_n + \frac{a}{x_n}\right).
\]</div>
<p>Intuitively, this makes sense: if <span class="arithmatex">\(x_n\)</span> is too large (<span class="arithmatex">\(x_n &gt; \sqrt{a}\)</span>), then <span class="arithmatex">\(a/x_n\)</span> will be too small (<span class="arithmatex">\(a/x_n &lt; \sqrt{a}\)</span>),
and their arithmetic mean <span class="arithmatex">\(x_{n+1}\)</span> will be closer to <span class="arithmatex">\(\sqrt{a}\)</span>.
This algorithm was known in Babylon over three thousand years ago — the famous <a href="https://en.wikipedia.org/wiki/YBC_7289">YBC 7289 tablet</a> contains a value of <span class="arithmatex">\(\sqrt{2}\)</span> accurate to six decimal places.</p>
<p>Three thousand years later, it was discovered that this algorithm is equivalent to Newton's method for finding roots of the equation <span class="arithmatex">\(f(x) = x^2 - a\)</span>.
Given an approximation <span class="arithmatex">\(x_n\)</span>, we approximate the function <span class="arithmatex">\(f\)</span> by its tangent at <span class="arithmatex">\(x_n\)</span> using a first-order Taylor expansion:</p>
<div class="arithmatex">\[ f(x_n) + f'(x_n)(x - x_n) \]</div>
<p>Setting this function to zero gives us an improved root approximation:</p>
<div class="arithmatex">\[ x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)} \]</div>
<p>which leads exactly to the Babylonian formula.</p>
<p>The only remaining question is when to stop.
In my code, I stop when the new approximation is exactly equal to the previous one.
Phew, that’s the end of the math! Apologies, but I had to explain what the test program does.
I chose this example because it is short enough while still using almost all concepts of <em>wend</em>.</p>
<h2 id="ast-for-the-sqrt">AST for the sqrt()</h2>
<p>Let me draw the syntax tree of our program.
The root of the tree is the entry point, the <code>main()</code> function.
Here’s what the full tree looks like:</p>
<p><img alt="" src="sqrt.png" /></p>
<p>The <code>main</code> function has two nested functions, which are children of the function list <code>fun</code>, as well as an instruction list <code>body</code>.
It is important to understand that this tree represents the structure of the program, but not its execution.
Unlike the previous example with RPN, to compute the value at the <code>println</code> node, we might need to make multiple recursive evaluations of the neighboring <code>sqrt</code> node.</p>
<p>Enough talking — I'm impatient to write some actual code! Let's get started.
Take a close look at the tree: we can implement this abstraction with three main types of nodes:</p>
<ol>
<li>Function declarations</li>
<li>Statements</li>
<li>Expressions</li>
</ol>
<p>Let's create a module <a href="https://github.com/ssloy/tinycompiler/blob/4c46a43550e6303ec9ce0ea10327e43648a6fa27/syntree.py">syntree.py</a>, which will store data exclusively, without any logic.
A function declaration class might look something like this:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Function</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">deco</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>       <span class="c1"># function name, string</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>       <span class="c1"># function arguments, list of tuples (name, type)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var</span>  <span class="o">=</span> <span class="n">var</span>        <span class="c1"># local variables, list of tuples (name, type)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fun</span>  <span class="o">=</span> <span class="n">fun</span>        <span class="c1"># nested functions, list of Function nodes</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>       <span class="c1"># function body, list of statement nodes (Print/Return/Assign/While/IfThenElse/FunCall)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deco</span> <span class="o">=</span> <span class="n">deco</span> <span class="ow">or</span> <span class="p">{}</span> <span class="c1"># decoration dictionary to be filled by the parser (line number) and by the semantic analyzer (return type, scope id etc)</span>
</span></code></pre></div>
<p>The class has a field for the function name, a list of arguments, local variables, nested functions, and a list of instructions that make up the function body.
I also added an additional dictionary called <code>deco</code>, where I will put various uninteresting information such as the line number in the file, so that the error handler doesn't complain in very cryptic terms.
But that will be much later, for now, it will be an empty dictionary.</p>
<p>In exactly the same way, I have written instruction classes <code>Print</code>, <code>Return</code>, <code>Assign</code>, <code>While</code>, <code>IfThenElse</code>, as well as expression classes <code>ArithOp</code>, <code>LogicOp</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code>, <code>Var</code>, and <code>FunCall</code>.
That's all, nothing more is needed for the <code>wend</code> compiler!
The module code contains 64 lines, and I will not include it here in full, as it does not contain any logic, it is purely a storage.
It should no longer change until the very end (well, at least if my hands aren't completely crooked :) )
The source code is <a href="https://github.com/ssloy/tinycompiler/blob/4c46a43550e6303ec9ce0ea10327e43648a6fa27/syntree.py">available on GitHub</a>.</p>
<p>Now let's write some interesting code. Let's create a syntax tree from our example:</p>
<details class="example">
<summary>AST created manually</summary>
<div class="language-py highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">abs_fun</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span>       <span class="c1"># function name</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">})],</span> <span class="c1"># one integer argument</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="p">[],</span>                         <span class="c1"># no local variables</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="p">[],</span>                         <span class="c1"># no nested functions</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="p">[</span>                           <span class="c1"># function body</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="n">IfThenElse</span><span class="p">(</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>            <span class="n">LogicOp</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>           <span class="c1"># if x &lt; 0</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>            <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)))],</span> <span class="c1"># then return 0-x</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>            <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">))])</span>                           <span class="c1"># else return x</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="p">],</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">})</span>          <span class="c1"># return type</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="n">sqrt_fun</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span>                                      <span class="c1"># function name</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="p">[(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">}),</span> <span class="p">(</span><span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">})],</span>    <span class="c1"># input fixed-point number (two integer variables)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="p">[</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">}),</span>                                <span class="c1"># three local integer variables</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>        <span class="p">(</span><span class="s1">&#39;x_old&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">}),</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        <span class="p">(</span><span class="s1">&#39;n_one&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">})</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="p">],</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="p">[],</span>                                                         <span class="c1"># no nested functions</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="p">[</span>                                                           <span class="c1"># function body</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>        <span class="n">IfThenElse</span><span class="p">(</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="n">LogicOp</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">2147483647</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;shift&#39;</span><span class="p">))),</span>             <span class="c1"># if n &gt; 65535</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>            <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>                    <span class="c1">#    return 2*sqrt(n/4)</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>                    <span class="n">FunCall</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;shift&#39;</span><span class="p">)])))],</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>            <span class="p">[]),</span>                                                <span class="c1"># no else statements</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;shift&#39;</span><span class="p">)),</span>                              <span class="c1"># x = shift</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;n_one&#39;</span><span class="p">,</span> <span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;shift&#39;</span><span class="p">))),</span>  <span class="c1"># n_one = n*shift</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="n">While</span><span class="p">(</span><span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="p">[</span>                                  <span class="c1"># while true</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>            <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;x_old&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)),</span>                          <span class="c1">#     x_old = x</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>            <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>                                         <span class="c1">#     x = (x + n_one / x) / 2</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>                <span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>                    <span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>                        <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>                        <span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;n_one&#39;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">))),</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>                    <span class="n">Integer</span><span class="p">(</span><span class="mi">2</span><span class="p">))),</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>            <span class="n">IfThenElse</span><span class="p">(</span>                                         <span class="c1">#     if abs(x-x_old) &lt;= 1</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>                <span class="n">LogicOp</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>                    <span class="n">FunCall</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">ArithOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x_old&#39;</span><span class="p">))]),</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>                    <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">))],</span>                             <span class="c1">#        return x</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>                <span class="p">[]),</span>                                            <span class="c1">#     no else statements</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>        <span class="p">]),</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>    <span class="p">],</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">INT</span><span class="p">})</span>                                          <span class="c1"># return type</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="n">main_fun</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="c1"># function name</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>    <span class="p">[],</span>                     <span class="c1"># no arguments</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>    <span class="p">[],</span>                     <span class="c1"># no local variables</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>    <span class="p">[</span><span class="n">sqrt_fun</span><span class="p">,</span> <span class="n">abs_fun</span><span class="p">],</span>    <span class="c1"># two nested functions</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>    <span class="p">[</span><span class="n">Print</span><span class="p">(</span>                 <span class="c1"># println sqrt(25735, 8192);</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>        <span class="n">FunCall</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">25735</span><span class="p">),</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">8192</span><span class="p">)]),</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>        <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>    <span class="p">],</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Type</span><span class="o">.</span><span class="n">VOID</span><span class="p">})</span>     <span class="c1"># return type</span>
</span></code></pre></div>
</details>
<p>We will discuss next time about how to create such a tree from source text automatically.
For now, compare this code to the tree diagram.
An attentive reader will notice some discrepancies, for example, the unary operation <code>-x</code> is represented as the binary operation <code>0-x</code>, but these are implementation details:
the programmer using <em>wend</em> should be able to write <code>-x</code> without worrying about how exactly this expression is transformed into a syntax tree.</p>
<p>For completeness, I have included the type of variables and function returns in the decoration dictionaries of our Christmas tree, but at this stage, I will not use it,
as Python has dynamic typing, and type inference and checking will concern me much later.</p>
<h2 id="from-syntax-tree-to-python-code">From syntax tree to python code</h2>
<p>The final code can be generated with a simple depth-first traversal of our syntax tree.
For example, if we visit an <code>Assign</code> node, it is guaranteed to have only two children: a <code>Var</code> node representing the variable we are assigning to,
and one of the expression nodes <code>ArithOp</code>, <code>LogicOp</code>, <code>Integer</code>, <code>Boolean</code>, <code>Var</code>, and <code>FunCall</code>.
Note that the <code>Var</code> node itself is an expression (we can assign the value of another variable, right?).
However, as you might have noticed, I am not obsessed by hierarchy of classes, and there is no inheritance at all; the separation into expressions and instructions is quite informal.</p>
<p>Back to the code generation during the visit of an <code>Assign</code>, this node has two children: the string <code>Assign.name</code> and a reference to another expression node <code>Assign.expr</code>.
My compiler code has the following structure:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">stat</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Assign</span><span class="p">):</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">expr</span><span class="p">))</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span></code></pre></div>
<p>That is, we generate code like <code>x = src</code>, where <code>src</code> is the expression code generated by the call to the <code>expr(n.expr)</code> function.
The <a href="https://github.com/ssloy/tinycompiler/blob/4c46a43550e6303ec9ce0ea10327e43648a6fa27/transpy_naive.py">full source code of the code generator</a> from the syntax tree can be found on GitHub, it's just 50 lines.
By <a href="https://github.com/ssloy/tinycompiler/blob/4c46a43550e6303ec9ce0ea10327e43648a6fa27/tests/test_syntree.py">running our not-yet-a-compiler</a> on a manually constructed syntax tree, we get the following result:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>            <span class="n">x_old</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>            <span class="n">n_one</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">((</span><span class="mi">2147483647</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">shift</span><span class="p">)):</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>                    <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">shift</span><span class="p">))</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>                    <span class="k">pass</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">shift</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>            <span class="n">n_one</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">shift</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>                    <span class="n">x_old</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>                    <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">n_one</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x_old</span><span class="p">)))</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>                            <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>                            <span class="k">pass</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>                    <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>                    <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">25735</span><span class="p">,</span> <span class="mi">8192</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>When this file is run, 14519 will be displayed on the screen, which is the representation of the number <span class="arithmatex">\(\sqrt\pi\)</span> with a precision of 13 bits after the decimal point!
We'll talk about displaying 3.1414 instead of 14519 next time, as I don't feel like manually constructing syntax trees any further.</p>
<p>Check the <a href="https://github.com/ssloy/tinycompiler/releases/tag/v0.0.1">v0.0.1</a> tag in the repository.</p>
<hr/>
<h3>Comments</h3>
<script src="https://giscus.app/client.js"
        data-repo="ssloy/ssloy.github.io"
        data-repo-id="R_kgDOLIjENg"
        data-category="General"
        data-category-id="DIC_kwDOLIjENs4CnFkC"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.annotate", "content.tooltips"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>