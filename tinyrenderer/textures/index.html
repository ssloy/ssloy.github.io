
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ssloy.github.io/tinyrenderer/textures/">
      
      
        <link rel="prev" href="../shading/">
      
      
        <link rel="next" href="../tangent/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>More data! - Playing with code</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-7F81P6F3D0"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-7F81P6F3D0",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-7F81P6F3D0",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#more-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Playing with code" class="md-header__button md-logo" aria-label="Playing with code" data-md-component="logo">
      
  <img src="../../haqreu-plate.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Playing with code
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              More data!
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Playing with code" class="md-nav__button md-logo" aria-label="Playing with code" data-md-component="logo">
      
  <img src="../../haqreu-plate.png" alt="logo">

    </a>
    Playing with code
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinyrenderer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            tinyrenderer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bresenham/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bresenham’s line drawing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rasterization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triangle rasterization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../barycentric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Barycentric coordinates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../z-buffer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hidden faces removal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../camera-naive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Naive camera handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../camera/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Better camera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    More data!
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    More data!
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#smooth-shading" class="md-nav__link">
    <span class="md-ellipsis">
      Smooth shading
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Smooth shading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curved-geometry" class="md-nav__link">
    <span class="md-ellipsis">
      Curved geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-practical-shortcut" class="md-nav__link">
    <span class="md-ellipsis">
      A practical shortcut
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework-1-smooth-shading" class="md-nav__link">
    <span class="md-ellipsis">
      Homework 1: smooth shading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#textures" class="md-nav__link">
    <span class="md-ellipsis">
      Textures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Textures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#homework-2-normal-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Homework 2: normal mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework-3-more-textures" class="md-nav__link">
    <span class="md-ellipsis">
      Homework 3: more textures!
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tangent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tangent space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shadow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ambient occlusion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../toon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bonus: toon shading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinycompiler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            tinycompiler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/ast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abstract syntax trees
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/sly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SLY: lexer and parser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/symtable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Symbol tables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Displays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/assembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assembly generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/lexer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DIY lexer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DIY parser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinycompiler/afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinyoptimizer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            tinyoptimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyoptimizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyoptimizer/mem2reg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mem2reg
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    tinyfloat
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            tinyfloat
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/computers-and-numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computers and Numbers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/print/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Printing floats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyfloat/add/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Addition
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    strange things
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            strange things
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strange/cursed-fire/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cursed fire or #define black magic
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#smooth-shading" class="md-nav__link">
    <span class="md-ellipsis">
      Smooth shading
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Smooth shading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curved-geometry" class="md-nav__link">
    <span class="md-ellipsis">
      Curved geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-practical-shortcut" class="md-nav__link">
    <span class="md-ellipsis">
      A practical shortcut
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework-1-smooth-shading" class="md-nav__link">
    <span class="md-ellipsis">
      Homework 1: smooth shading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#textures" class="md-nav__link">
    <span class="md-ellipsis">
      Textures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Textures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#homework-2-normal-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Homework 2: normal mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework-3-more-textures" class="md-nav__link">
    <span class="md-ellipsis">
      Homework 3: more textures!
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="more-data">More data!</h1>
<p>Let us continue our discussion about shading. How can we add more realism to our renders?
At this stage, I don’t want to introduce additional mathematics — instead, I want us to stop ignoring the data that is already available to us. We will continue to use the Phong reflection model that we <a href="./">implemented earlier</a>.</p>
<p>Our goal today is to gradually improve the realism of our renderings without making major changes to the shader itself:</p>
<p><a href="teaser.jpg"><img alt="" src="teaser.jpg" /></a></p>
<h2 id="smooth-shading">Smooth shading</h2>
<h3 id="curved-geometry">Curved geometry</h3>
<p>In the Phong reflection model, if the light direction and camera are fixed, the estimated light intensity depends only on the normal vector at the surface. In our previous implementation, the surface was composed of flat triangles, meaning each triangle had a single constant normal vector. The result was a very faceted look.</p>
<p>So, how can we achieve smoother renderings? The answer: provide more data.</p>
<p>One naïve approach would be to define an extremely fine mesh, so fine that each triangle is smaller than a pixel on screen. While this would produce smooth results, it is computationally very expensive. A cheaper, smarter method is preferable.</p>
<p>Do you recall the exercise on <a href="../bresenham/">drawing straight line segments</a>? Given two points <span class="arithmatex">\(P_0\)</span> and <span class="arithmatex">\(P_1\)</span>, we can interpolate between them:</p>
<div class="arithmatex">\[
P(t)= (1-t)\ P_0 + t\ P_1
\]</div>
<p>We vary the parameter <span class="arithmatex">\(t\)</span> between 0 and 1, thus sweeping the segment.
Here is a small Python implementation for those who want to experiment again:</p>
<details class="example">
<summary>straight.py</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="hll"><span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">P0</span> <span class="o">+</span> <span class="n">t</span><span class="o">*</span><span class="n">P1</span>
</span></span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>Expected output:</p>
<p><img alt="" src="straight.png" /></p>
<p>This process is simply <a href="https://en.wikipedia.org/wiki/Linear_interpolation">linear interpolation</a> between <span class="arithmatex">\(P_0\)</span> and <span class="arithmatex">\(P_1\)</span>. “Linear” means that <span class="arithmatex">\(P(t)\)</span> is a polynomial of order 1.</p>
<p>But what if we use a higher-order polynomial? 
For example, we can redefine <span class="arithmatex">\(P(t)\)</span> as follows:</p>
<div class="arithmatex">\[
P(t)= (1-t)^3\ P_0 + 3(1-t)^2 t\ P_1 + 3(1-t) t^2\ P_2 + t^3\ P_3
\]</div>
<p>Here we have four control points <span class="arithmatex">\(P_0, P_1, P_2, P_3\)</span>. Now <span class="arithmatex">\(P(t)\)</span> is a cubic function of <span class="arithmatex">\(t\)</span>. As <span class="arithmatex">\(t\)</span> varies from 0 to 1, the point sweeps out a curve, not a straight line. This is the principle of <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">Bézier curves</a>, widely used in <a href="https://en.wikipedia.org/wiki/Computer-aided_design">computer-aided design</a>.</p>
<p>Python implementation and visualization:</p>
<details class="example">
<summary>bezier.py</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1"># Bézier control points</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="c1"># Bézier curve</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="hll"><span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">P0</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">P1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">P2</span> <span class="o">+</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">P3</span>
</span></span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1"># plot it</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p><img alt="" src="bezier.png" /></p>
<p>Another way to define the same curve is by specifying endpoint normal vectors instead of adding extra control points:</p>
<p><img alt="" src="hermite.png" /></p>
<p class="annotate">This is known as a <a href="https://en.wikipedia.org/wiki/Cubic_Hermite_spline">cubic Hermite spline</a> (1). Here is a python code:</p>
<ol>
<li>Traditional Hermite interpolation uses tangent vectors instead of normals, but the idea is similar.</li>
</ol>
<details class="example">
<summary>hermite.py</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="c1"># Hermite control points and normals</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1"># Hermite curve</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="hll"><span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">P0</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">P1</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="nd">@N0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="nd">@N1</span><span class="p">)</span>
</span></span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1"># plot it</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>Back to our task: it is possible to define curved triangles if, in addition to vertex positions, we specify normal vectors at each vertex:</p>
<p><img alt="" src="curved-triangle.png" /></p>
<p>Fortunately, artists already provide this data. Until now, we only considered lines starting with <code>v</code> and <code>f</code> in the <a href="https://en.wikipedia.org/wiki/Wavefront_.obj_file">Wavefront OBJ format</a>. Now, we must also consider <code>vn</code> lines, which define 3D normal vectors:
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>vn 0 1 0
</span></code></pre></div>
This represents a vector aligned with the <span class="arithmatex">\(y\)</span>-axis.
<code>f</code> lines (faces) now include references to both vertex and normal indices:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>f 6/4/1 3/5/3 7/6/5
</span></code></pre></div>
Here, the first and last numbers of each slash-separated triplet correspond to vertex indices (from <code>v</code>) and normal indices (from <code>vn</code>). For example, this face uses vertices 6, 3, and 7, with normals 1, 3, and 5. Remember: OBJ indices start from 1, so you must subtract 1 when working with C++ arrays.</p>
<p>We’ll handle the remaining <code>vt</code> texture coordinate lines later.</p>
<p>Parsing <code>v</code>, <code>vn</code>, and <code>f</code> gives us data like this:</p>
<p><img alt="" src="normals.png" /></p>
<p>There are vertices connected into triangles, and there are vectors specified per vertex.</p>
<h3 id="a-practical-shortcut">A practical shortcut</h3>
<p>While defining true curved geometry is possible, it’s expensive. Instead, let’s “cheat.” During rasterization, each fragment <span class="arithmatex">\(P\)</span> is already computed as a barycentric interpolation of triangle vertices:</p>
<div class="arithmatex">\[
P = \alpha_0 P_0 + \alpha_1 P_1 + \alpha_2 P_2.
\]</div>
<p>Instead of computing the normal as <span class="arithmatex">\(\vec{n} = \overrightarrow{P_0P_1} \times \overrightarrow{P_0P_2}\)</span>, we interpolate the vertex normals:</p>
<div class="arithmatex">\[
\vec{n} = \alpha_0 \vec{n_0} + \alpha_1 \vec{n_1} + \alpha_2 \vec{n_2}.
\]</div>
<p>This gives varying shading across the triangle surface:</p>
<p><img alt="" src="interpolated-normal.png" /></p>
<p>The geometry remains flat, but the varying shading tricks the eye into perceiving smoothness.
Since usually the curvature of the triangles is pretty low, this simple computational hack is enough to produce visually plausible results.</p>
<h3 id="homework-1-smooth-shading">Homework 1: smooth shading</h3>
<p>Parse per-vertex normals and update your shader to use them. The faceted look will disappear, and you’ll obtain smooth surfaces:</p>
<p><img alt="" src="phong.png" /></p>
<p>Although the triangles are still flat (noticeable at the silhouette), the shading convinces the eye otherwise. <a href="https://github.com/ssloy/tinyrenderer/commit/e42447a9bf2a64f4a33bcb755f9ff54d8787420b">Here is my implementation</a> for reference, but try implementing it yourself first.</p>
<details class="bug">
<summary>Normal vector transformation caveat</summary>
<p>If you have implemented the <a href="../camera/">camera model</a>, then the vertices are transformed by the <code>ModelView</code> matrix.
Since normal vectors are also given in the model space, and the shading is done in camera space, we need to transform the normals along with the vertices.
It is tempting to apply <code>ModelView</code> matrix to the normals as well, and it will work most of the time. There is a caveat though.</p>
<p><img alt="" src="mit.svg" /></p>
<p>Imagine we have a 2D scene made of one segment with endpoints (0, 1) and (1, 0).
Then the tangent vector <span class="arithmatex">\(\vec t\)</span> can be found as the difference between them:</p>
<p>$$
    \vec{t} := (1\ 0)^\top - (0\ 1)^\top = (1\ -1)^\top.
$$
Vector <span class="arithmatex">\(\vec{n} := (1\ 1)^\top\)</span> is normal to the segment, since <span class="arithmatex">\(\vec t \perp \vec n\)</span>:</p>
<div class="arithmatex">\[
\vec{t} \cdot \vec{n} = 1\cdot 1 + (-1)\cdot 1 = 0.
\]</div>
<p>I want to transform the geometry by the matrix <span class="arithmatex">\(M\)</span> defined as follows:</p>
<div class="arithmatex">\[
M := \begin{pmatrix}1 &amp; 0 \\ 0 &amp; 2\end{pmatrix}.
\]</div>
<p>The transformed tangent <span class="arithmatex">\(\vec{t'}\)</span> is easy to compute:</p>
<div class="arithmatex">\[
\vec{t'} = M\ \vec t = (1\ -2)^\top.
\]</div>
<p>Now let us check the vector <span class="arithmatex">\(\vec m\)</span> that was obtained as the direct transformation of <span class="arithmatex">\(\vec n\)</span> by <span class="arithmatex">\(M\)</span>:</p>
<div class="arithmatex">\[
\vec{m} := M\ \vec n = (1\ 2)^\top.
\]</div>
<p>It turns out that <span class="arithmatex">\(\vec m\)</span> is <strong>not</strong> orthogonal to <span class="arithmatex">\(\vec{t'}\)</span>:</p>
<div class="arithmatex">\[
\vec{t'}\cdot\vec{m} = 1\cdot 1 + (-2)\cdot 2 \neq 0.
\]</div>
<p>In other words, <strong>we do not need to transform normals, we need to compute normals to the transformed geometry.</strong>
It is easy to do, let us define another vector <span class="arithmatex">\(\vec{n'}\)</span> as follows:</p>
<div class="arithmatex">\[
\vec{n'} := (M^{-1})^{\top} \vec{n}
\]</div>
<p>We can easily verify that <span class="arithmatex">\(\vec{n'} \perp \vec{t'}\)</span>:</p>
<div class="arithmatex">\[
\vec{n'} \cdot \vec{t'} = ((M^{-1})^\top \vec{n}) \cdot (M \vec{t}) =  \vec{n} \cdot (M^{-1} M \vec{t}) = \vec n \cdot \vec t = 0.
\]</div>
<p>In this line I have used the property of the dot product <span class="arithmatex">\((B^\top \vec{a}) \cdot \vec{b} = \vec{a} \cdot (B\vec{b})\)</span>.</p>
<p>Let us verify the reasoning on our example:</p>
<div class="arithmatex">\[
(M^{-1})^\top = \begin{pmatrix}1 &amp; 0 \\ 0 &amp; \frac12\end{pmatrix},
\]</div>
<p>and since the vector <span class="arithmatex">\(\vec{n'}\)</span> is defined as <span class="arithmatex">\(\vec{n'} := (M^{-1})^{\top} \vec{n}\)</span>, </p>
<div class="arithmatex">\[
\vec{n'} = \begin{pmatrix}1 &amp; 0 \\ 0 &amp; \frac12\end{pmatrix} \begin{pmatrix}1 \\ 1\end{pmatrix} = \begin{pmatrix}1 \\ \frac12 \end{pmatrix}.
\]</div>
<p>Let us check that <span class="arithmatex">\(\vec{n'}\perp \vec{t'}\)</span>:</p>
<div class="arithmatex">\[
    \vec{n'}\cdot \vec{t'} = 1 \cdot 1 + \frac12 \cdot (-2) = 0.
\]</div>
<p>It all check out. To sum up, if a model is transformed by a matrix <span class="arithmatex">\(M\)</span>, we can convert its normal vectors by the matrix <span class="arithmatex">\(M^{-\top}\)</span>.
You can check <a href="https://github.com/ssloy/tinyrenderer/blob/e42447a9bf2a64f4a33bcb755f9ff54d8787420b/main.cpp#L20">this line of code</a>.</p>
<p>As I have said, pretty often all this is not necessary, and we can simply transform normals by <span class="arithmatex">\(M\)</span>. If <span class="arithmatex">\(M\)</span> is orthogonal (for example, it is a simple rotation),
then <span class="arithmatex">\(M^{-1} = M^\top\)</span>, and therefore <span class="arithmatex">\(M = M^{-\top}\)</span>.
However, if your <code>ModelView</code> matrix contains some shearing or uneven scaling, then you need to correctly transform your normals.</p>
</details>
<h2 id="textures">Textures</h2>
<p>By introducing per-vertex normals, we improved shading realism. But can we add even more detail? Yes: by storing additional information in textures.</p>
<p>OBJ files also contain <code>vt</code> lines, which define 2D coordinates (the <em>UV space</em>). Each face (<code>f</code> line) links 3D vertices with 2D texture coordinates. Thus, for every triangle, we now have both its 3D geometry and a 2D mapping:</p>
<p><img alt="" src="textures.png" /></p>
<p>The 2D space is commonly called <a href="https://en.wikipedia.org/wiki/UV_mapping">the UV space</a>.
The idea is to superpose the flattened 2D mesh onto an image.
When we rasterize a triangle with vertices <span class="arithmatex">\(P_0, P_1, P_2\)</span>, for every fragment <span class="arithmatex">\(P\)</span> we find its barycentric coordinates <span class="arithmatex">\(\alpha_0, \alpha_1, \alpha_2\)</span> so that
<span class="arithmatex">\(P = \sum \alpha_i P_i\)</span>.
We know that the same triangle has coordinates <span class="arithmatex">\(U_0, U_1, U_2\)</span> in the UV space, we can therefore compute the UV counterpart <span class="arithmatex">\(U\)</span> of the fragement <span class="arithmatex">\(P\)</span>:</p>
<div class="arithmatex">\[
    U := \alpha_0 U_0 + \alpha_1 U_1 + \alpha_2 U_2.
\]</div>
<p>This process is called <a href="https://en.wikipedia.org/wiki/UV_mapping">UV mapping</a>. Traditionally, it is used to assign fragment colors by sampling an image at <span class="arithmatex">\(U\)</span>:</p>
<p><img alt="" src="uv.jpg" /></p>
<p>Originally, textures stored only colors. Nowadays, they are used much more generally. For example, since a 3D normal vector has three components and a texture has three channels, we can encode normals inside images — a technique known as normal mapping.</p>
<p>To do this, we remap color channels from  <span class="arithmatex">\([0\dots 255]\)</span> into <span class="arithmatex">\([-1,1]\)</span> vector components.</p>
<!-- ![](textures/uv-map.jpg) -->

<h3 id="homework-2-normal-mapping">Homework 2: normal mapping</h3>
<p>For each model, I have prepared files with <code>_nm.tga</code> suffix (ignore <code>_nm_tangent.tga</code> files for a moment).
Sample normals from these maps and use them in shading to create highly detailed surfaces:</p>
<p><img alt="" src="normalmap.jpg" /></p>
<p>Note that with this approach, we entirely throw away the vertex normals coming from the <code>vn</code> lines in the .obj.
Do not worry, they will be useful for tangent space normal mapping.</p>
<div class="admonition bug">
<p class="admonition-title">Color channel caveat</p>
<p>We need to map RGB channels is mapped to <span class="arithmatex">\(xyz\)</span> coordinates, but recall that <code>TGAColor</code> structure encodes the channels in the BGRA order.</p>
</div>
<p>For reference, <a href="https://github.com/ssloy/tinyrenderer/commit/f68629a190055e702493bcfa7d7f91427b2be722">here is my commit</a>.</p>
<h3 id="homework-3-more-textures">Homework 3: more textures!</h3>
<p>I have ignored colors for as long as I could, but this time it would be unreasonable to avoid them.
You can load colors from the textures with <code>_diff.tga</code> suffix.
But there are much more kinds of textures: there are specular textures (<code>_spec.tga</code> suffix) that provide the specular intensity weight in the Phong reflection model,
there are incadecence textures (<code>_glow.tga</code> suffix), there are <a href="https://en.wikipedia.org/wiki/Subsurface_scattering">subsurface scattering</a> textures and many, many others that I won't cover in this tutorial.
Here I used diffuse color + specular textures, try to reproduce the image:</p>
<p><img alt="" src="colors.jpg" /></p>
<hr />
<p>That concludes this chapter. With just a bit of additional data (per-vertex normals and few textures) we can dramatically increase realism without fundamentally changing our rendering pipeline.</p>
<hr/>
<h3>Comments</h3>
<script src="https://giscus.app/client.js"
        data-repo="ssloy/ssloy.github.io"
        data-repo-id="R_kgDOLIjENg"
        data-category="General"
        data-category-id="DIC_kwDOLIjENs4CnFkC"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.annotate", "content.tooltips"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>